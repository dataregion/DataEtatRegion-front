# "generate-openapi-clients":
#   stage: üß™ post-deploy tests
#   image: docker:28.0-dind
#   script:
#     - apk add --no-cache bash curl jq
#     - printf 'yy' | ./generate_openapi_client.sh -p ae -s "https://api.nocode.csm.ovh/apis-externes/swagger.json" -t $(pwd)/apps/clients/ -n apis-externes
#     - printf 'yy' | ./generate_openapi_client.sh -p budget -s "https://api.nocode.csm.ovh/financial-data/api/v2/swagger.json" -t $(pwd)/apps/clients/ -n budget
#   needs:
#     - job: "üê£ deploy fronts on integration"
#   rules:
#     - if: '$DO_INTEG_TESTS == "‚úÖ"'
#     - when: manual

run-tests-e2e:
  stage: üß™ post-deploy tests
  image: mcr.microsoft.com/playwright:v1.56.1-noble@sha256:f1e7e01021efd65dd1a2c56064be399f3e4de00fd021ac561325f2bfbb2b837a
  script:
    - cd e2e/
    - npm ci
    - export TEST_USERNAME=${TEST_USERNAME}
    - export TEST_PASSWORD=${TEST_PASSWORD}
    - export TEST_USERNAME_ADMIN=${TEST_USERNAME_ADMIN}
    - export TEST_PASSWORD_ADMIN=${TEST_PASSWORD_ADMIN}
    - export BUDGET_BRETAGNE_BASE_URL="https://budget-bretagne.nocode.csm.ovh" 
    - npx playwright test
  artifacts:
    expire_in: 3 days
    when: always
    paths:
      - e2e/playwright-report/*
      - e2e/test-results/*
      - test-results/*
      - playwright-report/*
  needs:
    - job: "üê£ deploy fronts on integration"
      optional: true
  rules:
    - if: '$DO_INTEG_TESTS == "‚úÖ"'
    - if: '$DO_INTEG_TESTS == "‚öôÔ∏è"'
      when: manual
    - when: never