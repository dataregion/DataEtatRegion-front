"ğŸ”¨ build angular apps":
  image: node:24.12.0@sha256:929c026d5a4e4a59685b3c1dbc1a8c3eb090aa95373d3a4fd668daa2493c8331
  stage: ğŸ”¨ build

  cache:
    key:
      files:
        - package-lock.json
        - package.json
    paths:
      - node_modules/
    policy: pull-push

  before_script:
    - |
      set -x
      if [ ! -d "./node_modules" ]; then
        echo >&2 'node_modules cache not available. run ci.'
        npm ci --prefer-offline --quiet
      fi

  script:
    - |
      npm run lint

      echo >&2 "ğŸ”¨ Building budget-dataetat-dev"
      npm run build:budget-dev

      echo >&2 "ğŸ”¨ Building budget-dataetat"
      npm run build:budget

      echo >&2 "ğŸ”¨ Building france-relance"
      npm run build:france-relance

      echo >&2 "ğŸ”¨ Building data-qpv"
      npm run build:data-qpv

      set +x

  artifacts:
    expire_in: 30 mins
    paths:
      - dist/

  rules:
    - if: '$DO_BUILD == "âœ…"'
    - if: '$DO_BUILD == "âš™ï¸"'
      when: manual
    - when: never